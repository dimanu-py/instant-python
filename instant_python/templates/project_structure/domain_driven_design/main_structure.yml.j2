{% import "domain_driven_design/layer_macros.j2" as layer with context %}
{# === Core Project Structure === #}
{{ layer.include_block("domain_driven_design/source.yml.j2", 0) }}
{{ layer.include_block("domain_driven_design/test.yml.j2", 0) }}

{# === Base Configuration Files === #}
{{ layer.include_block("config_files/pyproject.yml.j2", 0) }}
{{ layer.include_block("config_files/python_version.yml.j2", 0) }}
{{ layer.include_block("license.yml.j2", 0) }}

{# === CI/CD and Automation Features === #}
{% set ci_cd_features = [
    {"feature": "github_actions", "template": "github/github_action.yml.j2"},
    {"feature": "github_actions", "template": "github/makefile.yml.j2"},
    {"feature": "github_issues_template", "template": "github/github_issues_template.yml.j2"},
    {"feature": "makefile", "template": "github/makefile.yml.j2"},
    {"feature": "precommit_hook", "template": "github/precommit_hook.yml.j2"},
    {"feature": "precommit_hook", "template": "github/makefile.yml.j2"}
] %}
{{ layer.render_features(ci_cd_features, 0) }}

{# === Git Features === #}
{% if git.initialize %}
{{ layer.include_block("config_files/gitignore.yml.j2", 0) }}
{{ layer.include_block("documentation/readme.yml.j2", 0) }}
{% endif %}

{# === Testing and Type Checking === #}
{% if dependencies | has_dependency("pytest") %}
{{ layer.include_block("config_files/pytest.yml.j2", 0) }}
{% endif %}
{% if dependencies | has_dependency("mypy") %}
{{ layer.include_block("config_files/mypy.yml.j2", 0) }}
{% endif %}

{# === Database Migration === #}
{{ layer.render_feature_if_enabled("async_alembic", "persistence/async_alembic.yml.j2", 0) }}

{# === Documentation and Metadata === #}
{% set doc_features = [
    {"feature": "citation_file", "template": "documentation/citation.yml.j2"},
    {"feature": "security_file", "template": "documentation/security.yml.j2"}
] %}
{{ layer.render_features(doc_features, 0) }}
